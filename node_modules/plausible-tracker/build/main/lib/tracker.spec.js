"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
/* eslint-disable functional/immutable-data */
const requestModule = __importStar(require("./request"));
const tracker_1 = __importDefault(require("./tracker"));
const requestSpy = jest.spyOn(requestModule, 'sendEvent');
beforeEach(() => {
    jest.clearAllMocks();
    requestSpy.mockImplementation();
});
describe('tracker', () => {
    const getDefaultData = () => ({
        hashMode: false,
        trackLocalhost: false,
        url: location.href,
        domain: location.hostname,
        referrer: document.referrer || null,
        deviceWidth: window.innerWidth,
        apiHost: 'https://plausible.io',
    });
    const getCustomData = () => ({
        hashMode: true,
        trackLocalhost: true,
        url: 'https://my-url.com',
        domain: 'my-domain.com',
        referrer: 'my-referrer',
        deviceWidth: 1080,
        apiHost: 'https://my-api-hos.t',
    });
    const getEventOptions = () => ({
        callback: jest.fn(),
        props: {
            variation1: 'A',
            variation2: 'B',
        },
    });
    test('inits with default config', () => {
        const { trackEvent } = tracker_1.default();
        expect(requestSpy).not.toHaveBeenCalled();
        trackEvent('myEvent');
        expect(requestSpy).toHaveBeenCalled();
        expect(requestSpy).toHaveBeenCalledWith('myEvent', expect.objectContaining(getDefaultData()), undefined);
    });
    test('inits with overridden config', () => {
        const config = getCustomData();
        const { trackEvent } = tracker_1.default(config);
        expect(requestSpy).not.toHaveBeenCalled();
        trackEvent('myEvent');
        expect(requestSpy).toHaveBeenCalled();
        expect(requestSpy).toHaveBeenCalledWith('myEvent', config, undefined);
    });
    describe('trackEvent', () => {
        test('tracks event', () => {
            const { trackEvent } = tracker_1.default();
            expect(requestSpy).not.toHaveBeenCalled();
            trackEvent('myEvent');
            expect(requestSpy).toHaveBeenCalled();
            expect(requestSpy).toHaveBeenCalledWith('myEvent', getDefaultData(), undefined);
        });
        test('accepts data on trackEvent', () => {
            const { trackEvent } = tracker_1.default();
            expect(requestSpy).not.toHaveBeenCalled();
            const config = getCustomData();
            trackEvent('myEvent', undefined, config);
            expect(requestSpy).toHaveBeenCalled();
            expect(requestSpy).toHaveBeenCalledWith('myEvent', config, undefined);
        });
        test('accepts options on trackEvent', () => {
            const { trackEvent } = tracker_1.default();
            expect(requestSpy).not.toHaveBeenCalled();
            const options = getEventOptions();
            trackEvent('myEvent', options);
            expect(requestSpy).toHaveBeenCalled();
            expect(requestSpy).toHaveBeenCalledWith('myEvent', getDefaultData(), options);
        });
    });
    describe('pageView', () => {
        test('tracks pageview', () => {
            const { trackPageview } = tracker_1.default();
            expect(requestSpy).not.toHaveBeenCalled();
            trackPageview();
            expect(requestSpy).toHaveBeenCalled();
            expect(requestSpy).toHaveBeenCalledWith('pageview', getDefaultData(), undefined);
        });
        test('accepts data on pageview', () => {
            const { trackPageview } = tracker_1.default();
            expect(requestSpy).not.toHaveBeenCalled();
            const config = getCustomData();
            trackPageview(config);
            expect(requestSpy).toHaveBeenCalled();
            expect(requestSpy).toHaveBeenCalledWith('pageview', config, undefined);
        });
        test('accepts event options on pageview', () => {
            const { trackPageview } = tracker_1.default();
            expect(requestSpy).not.toHaveBeenCalled();
            const options = getEventOptions();
            trackPageview({}, options);
            expect(requestSpy).toHaveBeenCalled();
            expect(requestSpy).toHaveBeenCalledWith('pageview', getDefaultData(), options);
        });
    });
    describe('enableAutoPageviews', () => {
        test('tracks first pageview', () => {
            const { enableAutoPageviews } = tracker_1.default();
            expect(requestSpy).not.toHaveBeenCalled();
            const cleanup = enableAutoPageviews();
            expect(requestSpy).toHaveBeenCalledWith('pageview', getDefaultData(), undefined);
            cleanup();
        });
        test('does not track popstate if no history.pushState', () => {
            const originalPushState = history.pushState;
            const { enableAutoPageviews } = tracker_1.default();
            expect(requestSpy).not.toHaveBeenCalled();
            history.pushState = null;
            const cleanup = enableAutoPageviews();
            expect(requestSpy).toHaveBeenCalledTimes(1);
            window.dispatchEvent(new PopStateEvent('popstate'));
            expect(requestSpy).toHaveBeenCalledTimes(1);
            cleanup();
            history.pushState = originalPushState;
        });
        test('tracks pageviews on push state', () => {
            const { enableAutoPageviews } = tracker_1.default();
            expect(requestSpy).not.toHaveBeenCalled();
            const cleanup = enableAutoPageviews();
            expect(requestSpy).toHaveBeenCalledTimes(1);
            history.pushState({}, 'second', '/url');
            expect(requestSpy).toHaveBeenCalledTimes(2);
            cleanup();
        });
        test('tracks pageviews on popstate', () => {
            const { enableAutoPageviews } = tracker_1.default();
            expect(requestSpy).not.toHaveBeenCalled();
            const cleanup = enableAutoPageviews();
            expect(requestSpy).toHaveBeenCalledTimes(1);
            window.dispatchEvent(new PopStateEvent('popstate'));
            expect(requestSpy).toHaveBeenCalledTimes(2);
            cleanup();
        });
        test('does not track hashchange by default', () => {
            const { enableAutoPageviews } = tracker_1.default();
            expect(requestSpy).not.toHaveBeenCalled();
            const cleanup = enableAutoPageviews();
            expect(requestSpy).toHaveBeenCalledTimes(1);
            window.dispatchEvent(new HashChangeEvent('hashchange'));
            expect(requestSpy).toHaveBeenCalledTimes(1);
            cleanup();
        });
        test('tracks hashchange if specified', () => {
            const { enableAutoPageviews } = tracker_1.default({ hashMode: true });
            expect(requestSpy).not.toHaveBeenCalled();
            const cleanup = enableAutoPageviews();
            expect(requestSpy).toHaveBeenCalledTimes(1);
            window.dispatchEvent(new HashChangeEvent('hashchange'));
            expect(requestSpy).toHaveBeenCalledTimes(2);
            cleanup();
        });
    });
    describe('enableAutoOutboundTracking', () => {
        const createAnchors = (amount, start = 0) => {
            return [...Array(amount).keys()].map((i) => {
                const el = document.createElement('a');
                el.setAttribute('href', `https://link-${i + start}.com`);
                return el;
            });
        };
        const mountAnchors = (anchors) => {
            const div = document.createElement('div');
            anchors.forEach((a) => div.appendChild(a));
            document.body.append(div);
        };
        const clickLink = (anchor) => {
            anchor.click();
        };
        afterEach(() => {
            // Reset body
            document.body.innerHTML = '';
        });
        test('tracks existing anchors', () => {
            const anchors = createAnchors(10);
            mountAnchors(anchors);
            const { enableAutoOutboundTracking } = tracker_1.default(document);
            const cleanup = enableAutoOutboundTracking();
            expect(requestSpy).not.toHaveBeenCalled();
            // Click anchors
            anchors.forEach(clickLink);
            expect(requestSpy).toHaveBeenCalledTimes(10);
            anchors.forEach((a) => {
                expect(requestSpy).toHaveBeenCalledWith('Outbound Link: Click', expect.anything(), expect.objectContaining({
                    props: { url: a.href },
                }));
            });
            cleanup();
        });
        test('do not track host links', () => {
            const anchors = createAnchors(1);
            mountAnchors(anchors);
            const anchor = anchors[0];
            anchor.setAttribute('href', `https://${location.host}`);
            const { enableAutoOutboundTracking } = tracker_1.default(document);
            const cleanup = enableAutoOutboundTracking();
            expect(requestSpy).not.toHaveBeenCalled();
            // Click anchors
            anchors.forEach(clickLink);
            expect(requestSpy).not.toHaveBeenCalled();
            cleanup();
        });
        test('tracks href change', async () => {
            const anchors = createAnchors(1);
            mountAnchors(anchors);
            const { enableAutoOutboundTracking } = tracker_1.default(document);
            const cleanup = enableAutoOutboundTracking();
            const newHref = 'https://other.com/';
            // Change href
            const anchor = document.querySelector('a');
            expect(anchor).toBeTruthy();
            if (anchor) {
                anchor.removeAttribute('href');
                anchor.setAttribute('href', newHref);
            }
            expect(requestSpy).not.toHaveBeenCalled();
            // Wait for observer to run
            await new Promise((resolve) => setTimeout(() => {
                resolve(null);
            }, 100));
            // Click anchors
            anchors.forEach(clickLink);
            expect(requestSpy).toHaveBeenCalledTimes(1);
            expect(requestSpy).toBeCalledWith('Outbound Link: Click', expect.anything(), expect.objectContaining({
                props: { url: newHref },
            }));
            cleanup();
        });
        test('tracks node addition', async () => {
            const oldAnchors = createAnchors(5);
            mountAnchors(oldAnchors);
            const { enableAutoOutboundTracking } = tracker_1.default(document);
            const cleanup = enableAutoOutboundTracking();
            const newAnchors = createAnchors(5, 5);
            mountAnchors(newAnchors);
            expect(requestSpy).not.toHaveBeenCalled();
            const anchors = [...oldAnchors, ...newAnchors];
            // Wait for observer to run
            await new Promise((resolve) => setTimeout(() => {
                resolve(null);
            }, 100));
            // Click anchors
            anchors.forEach((a) => a.click());
            expect(requestSpy).toHaveBeenCalledTimes(10);
            anchors.forEach((a) => {
                expect(requestSpy).toHaveBeenCalledWith('Outbound Link: Click', expect.anything(), expect.objectContaining({
                    props: { url: a.href },
                }));
            });
            cleanup();
        });
        test('tracks node removal', async () => {
            var _a;
            const anchors = createAnchors(5);
            mountAnchors(anchors);
            const { enableAutoOutboundTracking } = tracker_1.default(document);
            const cleanup = enableAutoOutboundTracking();
            expect(requestSpy).not.toHaveBeenCalled();
            // Remove nodes
            (_a = document.querySelector('div')) === null || _a === void 0 ? void 0 : _a.remove();
            // Wait for observer to run
            await new Promise((resolve) => setTimeout(() => {
                resolve(null);
            }, 100));
            // Click anchors
            anchors.forEach(clickLink);
            expect(requestSpy).not.toHaveBeenCalled();
            cleanup();
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhY2tlci5zcGVjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi90cmFja2VyLnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsOENBQThDO0FBQzlDLHlEQUEyQztBQUMzQyx3REFBd0Q7QUFFeEQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFFMUQsVUFBVSxDQUFDLEdBQUcsRUFBRTtJQUNkLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUNyQixVQUFVLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztBQUNsQyxDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO0lBQ3ZCLE1BQU0sY0FBYyxHQUFxQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQzlELFFBQVEsRUFBRSxLQUFLO1FBQ2YsY0FBYyxFQUFFLEtBQUs7UUFDckIsR0FBRyxFQUFFLFFBQVEsQ0FBQyxJQUFJO1FBQ2xCLE1BQU0sRUFBRSxRQUFRLENBQUMsUUFBUTtRQUN6QixRQUFRLEVBQUUsUUFBUSxDQUFDLFFBQVEsSUFBSSxJQUFJO1FBQ25DLFdBQVcsRUFBRSxNQUFNLENBQUMsVUFBVTtRQUM5QixPQUFPLEVBQUUsc0JBQXNCO0tBQ2hDLENBQUMsQ0FBQztJQUVILE1BQU0sYUFBYSxHQUFxQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQzdELFFBQVEsRUFBRSxJQUFJO1FBQ2QsY0FBYyxFQUFFLElBQUk7UUFDcEIsR0FBRyxFQUFFLG9CQUFvQjtRQUN6QixNQUFNLEVBQUUsZUFBZTtRQUN2QixRQUFRLEVBQUUsYUFBYTtRQUN2QixXQUFXLEVBQUUsSUFBSTtRQUNqQixPQUFPLEVBQUUsc0JBQXNCO0tBQ2hDLENBQUMsQ0FBQztJQUVILE1BQU0sZUFBZSxHQUErQyxHQUFHLEVBQUUsQ0FBQyxDQUFD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